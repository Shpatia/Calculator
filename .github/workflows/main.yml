name: Calculator CI

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      - run: |
          python -m pip install --upgrade pip
          pip install pyinstaller
      - run: python -m unittest discover -s tests -p "test_*.py"

  build-windows:
    runs-on: windows-latest
    needs: test
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      - run: |
          python -m pip install --upgrade pip
          pip install pyinstaller
      - shell: bash
        run: |
          pyinstaller --onefile --windowed --name Calculator.exe \
            --add-data "ui.py;." \
            --add-data "advanced_math.py;." \
            --add-data "basic_ops.py;." \
            --add-data "memory.py;." \
            main.py
          mkdir installer
          cp dist/Calculator.exe installer/
      - uses: actions/upload-artifact@v4
        with:
          name: calculator-windows
          path: installer/Calculator.exe

  build-deb:
    runs-on: ubuntu-latest
    needs: test
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      - run: sudo apt-get update && sudo apt-get install -y dpkg-dev
      - run: pip install pyinstaller
      - run: |
          pyinstaller --onefile --windowed \
            --name calculator \
            --add-data "ui.py:." \
            --add-data "advanced_math.py:." \
            --add-data "basic_ops.py:." \
            --add-data "memory.py:." \
            main.py
      - run: |
          mkdir -p deb/DEBIAN deb/usr/bin
          cat > deb/DEBIAN/control << 'EOF'
          Package: calculator
          Version: 1.0-1
          Section: utils
          Priority: optional
          Architecture: amd64
          Maintainer: CI danyagorzshanov@yandex.ru
          Description: Calculator
          License: MIT License
          EOF
          cp dist/calculator deb/usr/bin/
          dpkg-deb --build deb
          mkdir installer
          mv deb.deb installer/calculator_1.0-1_amd64.deb
      - uses: actions/upload-artifact@v4
        with:
          name: calculator-deb
          path: installer/calculator_1.0-1_amd64.deb



